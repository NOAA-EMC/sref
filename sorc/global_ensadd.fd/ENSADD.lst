Page 1           Source Listing                  ENSADD
2015-06-03 22:07                                 ENSADD.f

      1 C$$$  MAIN PROGRAM DOCUMENTATION BLOCK
      2 C
      3 C MAIN PROGRAM: ENSADD
      4 C   PRGMMR: ZHU              ORG: NP23        DATE: 1999-08-31
      5 C
      6 C ABSTRACT: THIS PROGRAM WILL EXTEND PDS MESSAGE WHICH WILL  
      7 C           INCLUDE ENS(5) MESSAGE
      8 C
      9 C PROGRAM HISTORY LOG:
     10 C   96-10-??   MARK IREDELL     - Originator
     11 C   97-03-17   YUEJIAN ZHU      - Added DOCBLOACK
     12 C   99-07-26   YUEJIAN ZHU      - Modified to IBM-SP
     13 C   15-02-24   JUN DU           - Expanded and adopted for SREF
     14 C                                 as well as added a precision control
     15 C
     16 C USAGE:
     17 C
     18 C   INPUT FILES:
     19 C     UNIT  11  GRIB FILE ( maximum 512*256 )
     20 C     UNIT  21  GRIB INDEX FILE
     21 C     UNIT   5  READ *, IENST,IENSI (For ensemble message)
     22 C
     23 C   OUTPUT FILES:
     24 C     UNIT  51  GRIB FILE ( maximum 512*256 )
     25 C
     26 C   SUBPROGRAMS CALLED:
     27 C     GETGB  -- W3LIB ROUTINE
     28 C     PUTGBE -- W3LIB ROUTINE
     29 C
     30 C ATTRIBUTES:
     31 C   LANGUAGE: FORTRAN
     32 C
     33 C$$$
     34       program      ensadd
     35 C     parameter    (jf=512*256)
     36       parameter    (jf=697*553)
     37 c     integer      jpds(200),jgds(200),kpds(200),kgds(200),kens(200)
     38       integer      jpds(25),jgds(22),kpds(25),kgds(22),kens(20)
     39       integer      ienst,iensi                                        
     40       real         f(jf)
     41       character*80 cpgb,cpgi,cpge
     42       logical*1      lb(jf)
     43       namelist     /namin/ ienst,iensi,cpgb,cpgi,cpge      
     44 c
     45 c
     46 c     CALL W3LOG('$S97118.73','ENSADD')
     47       CALL W3TAGB('ENSADD',1999,0243,0068,'NP23')
     48 
     49       read (5,namin)
     50       lpgb=len_trim(cpgb)
     51       lpgi=len_trim(cpgi)
     52       lpge=len_trim(cpge)
     53       print *, cpgb(1:lpgb),'  ',cpgi(1:lpgi),'  ',cpge(1:lpge)
     54       call baopenr(11,cpgb(1:lpgb),iretb)
     55       call baopenr(21,cpgi(1:lpgi),ireti)
     56       call baopen (51,cpge(1:lpge),irete)
     57 

Page 2           Source Listing                  ENSADD
2015-06-03 22:07                                 ENSADD.f

     58       j=0
     59       jpds=-1
     60       call getgb(11,21,jf,j,jpds,jgds,kf,j,kpds,kgds,lb,f,iret)
     61       dowhile(iret.eq.0)
     62         kpds(23)=2   !ensemble
     63 C Precision control (J.Du)
     64         kpds(22)=2    !default
     65 
     66 c H, mslp, slp, pressure
     67         if(kpds(5).eq.7.or.kpds(5).eq.2) kpds(22)=0
     68         if(kpds(5).eq.130.or.kpds(5).eq.1) kpds(22)=0
     69 c cetegorical precip types
     70         if(kpds(5).eq.140.or.kpds(5).eq.141) kpds(22)=0
     71         if(kpds(5).eq.142.or.kpds(5).eq.143) kpds(22)=0
     72 c visibility
     73         if(kpds(5).eq.20) kpds(22)=0
     74 c categorical icing, turbulence
     75         if(kpds(5).eq.186.or.kpds(5).eq.185) kpds(22)=0
     76 c land-sea mask
     77         if(kpds(5).eq.81) kpds(22)=0
     78 c sea-ice mask
     79         if(kpds(5).eq.91) kpds(22)=0
     80 
     81 c radar reflectivity and echo top
     82         if(kpds(5).eq.212.or.kpds(5).eq.240) kpds(22)=1
     83 c u, v
     84         if(kpds(5).eq.33.or.kpds(5).eq.34) kpds(22)=1
     85 c cape, cin
     86         if(kpds(5).eq.157.or.kpds(5).eq.156) kpds(22)=1
     87 c storm relative helicity
     88         if(kpds(5).eq.190) kpds(22)=1
     89 c total cloud cover
     90         if(kpds(5).eq.71) kpds(22)=1
     91 c PBL height
     92         if(kpds(5).eq.221) kpds(22)=1
     93 c relative humidity and temperature
     94         if(kpds(5).eq.52.or.kpds(5).eq.11) kpds(22)=1
     95 c dew point temperature
     96         if(kpds(5).eq.17) kpds(22)=1
     97 
     98 c TKE
     99         if(kpds(5).eq.158) kpds(22)=3
    100 c soil moisture fraction
    101         if(kpds(5).eq.144) kpds(22)=4
    102 c precip rate
    103         if(kpds(5).eq.59) kpds(22)=5
    104 c specific humidity
    105         if(kpds(5).eq.51) kpds(22)=5
    106 c vorticity
    107         if(kpds(5).eq.41) kpds(22)=6
    108 c moisture divergence
    109         if(kpds(5).eq.135) kpds(22)=6
    110 c cloud ice and water
    111         if(kpds(5).eq.58.or.kpds(5).eq.153) kpds(22)=6
    112 
    113 c to avoid zero in relative humidity and specific humidity
    114         if(kpds(5).eq.52) f=f+0.1

Page 3           Source Listing                  ENSADD
2015-06-03 22:07                                 ENSADD.f

    115         if(kpds(5).eq.51) f=f+0.00001
    116 
    117         kens(1)=1
    118         kens(2)=ienst
    119         kens(3)=iensi
    120         kens(4)=1
    121         kens(5)=255
    122         if(kpds(6).eq.100.and.kpds(5).ne.222.and.kpds(5).ne.52)
    123      &  kens(5)=kgds(3)/2-1
    124         call putgbe(51,kf,kpds,kgds,kens,lb,f,iret)
    125         call getgb(11,21,jf,j,jpds,jgds,kf,j,kpds,kgds,lb,f,iret)
    126       enddo
    127  
    128       call baclose(11,iretb)
    129       call baclose(21,ireti)
    130       call baclose(51,irete)
    131 
    132 c     CALL W3LOG('$E')
    133       CALL W3TAGE('ENSADD')
    134 
    135       stop
    136       end


ENTRY POINTS

  Name              
                    
 MAIN__             

Page 4           Source Listing                  ENSADD
2015-06-03 22:07 Symbol Table                    ENSADD.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BACLOSE                    Subr   81                                                             81,82,83                          
 BAOPEN                     Subr   56                                                             56                                
 BAOPENR                    Subr   54                                                             54,55                             
 CPGB                       Local  41       CHAR            80          scalar                    43,50,53,54                       
 CPGE                       Local  41       CHAR            80          scalar                    43,52,53,56                       
 CPGI                       Local  41       CHAR            80          scalar                    43,51,53,55                       
 ENSADD                     Prog   34                                                                                               
 F                          Local  40       R(4)            4     1     385441                    60,68,69,77,78                    
 GETGB                      Subr   60                                                             60,78                             
 IENSI                      Local  39       I(4)            4           scalar                    43,72                             
 IENST                      Local  39       I(4)            4           scalar                    43,71                             
 IRET                       Local  60       I(4)            4           scalar                    60,61,77,78                       
 IRETB                      Local  54       I(4)            4           scalar                    54,81                             
 IRETE                      Local  56       I(4)            4           scalar                    56,83                             
 IRETI                      Local  55       I(4)            4           scalar                    55,82                             
 J                          Local  58       I(4)            4           scalar                    58,60,78                          
 JF                         Param  36       I(4)            4           scalar                    40,42,60,78                       
 JGDS                       Local  38       I(4)            4     1     22                        60,78                             
 JPDS                       Local  38       I(4)            4     1     25                        59,60,78                          
 KENS                       Local  38       I(4)            4     1     20                        70,71,72,73,74,76,77              
 KF                         Local  60       I(4)            4           scalar                    60,77,78                          
 KGDS                       Local  38       I(4)            4     1     22                        60,76,77,78                       
 KPDS                       Local  38       I(4)            4     1     25                        60,62,64,65,66,67,68,69,75,77,78  
 LB                         Local  42       L(1)            1     1     385441                    60,77,78                          
 LEN_TRIM                   Func   50                                   scalar                    50,51,52                          
 LPGB                       Local  50       I(4)            4           scalar                    50,53,54                          
 LPGE                       Local  52       I(4)            4           scalar                    52,53,56                          
 LPGI                       Local  51       I(4)            4           scalar                    51,53,55                          
 NAMIN                      Local  43                                   scalar                    49                                
 PUTGBE                     Subr   77                                                             77                                
 W3TAGB                     Subr   47                                                             47                                
 W3TAGE                     Subr   86                                                             86                                

Page 5           Source Listing                  ENSADD
2015-06-03 22:07 Subprograms/Common Blocks       ENSADD.f



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ENSADD                     Prog   34                                                                                               

COMPILER OPTIONS BEING USED

       -align nocommons                      -align nodcommons
       -align noqcommons                     -align records
       -align nosequence                     -align norec1byte
       -align norec2byte                     -align norec4byte
       -align norec8byte                     -align norec16byte
       -altparam                             -assume accuracy_sensitive
       -assume nobscc                        -assume nobuffered_io
       -assume nobyterecl                    -assume nocc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_unit_star                 -assume old_ldout_format
       -assume noold_logical_ldio            -assume old_maxminloc
       -assume old_xor                       -assume protect_constants
       -assume noprotect_parens              -assume split_common
       -assume source_include                -assume nostd_intent_in
       -assume nostd_mod_proc_name           -assume norealloc_lhs
       -assume underscore                    -assume no2underscores
  no   -auto                                 -auto_scalar
  no   -bintext                              -ccdefault default
       -check noargs                         -check noarg_temp_created
       -check nobounds                       -check noformat
       -check nooutput_conversion            -check nooverflow
       -check nopointers                     -check power
       -check noshape                        -check nounderflow
       -check nouninitialized                -coarray-num-procs 0
  no   -coarray-config-file                  -convert native
       -cross_reference                      -D __INTEL_COMPILER=1210
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D _MT                                -D __INTEL_COMPILER_BUILD_DATE=20120612
       -D __i686                             -D __i686__
       -D __pentiumpro                       -D __pentiumpro__
       -D __pentium4                         -D __pentium4__
       -D __tune_pentium4__                  -D __SSE2__
       -D __SSE__                            -D __MMX__
       -double_size 64                  no   -d_lines
  no   -Qdyncom                              -error_limit 30
  no   -f66                             no   -f77rtl
  no   -fast                                 -fpscomp nofilesfromcmd
       -fpscomp nogeneral                    -fpscomp noioformat
       -fpscomp noldio_spacing               -fpscomp nologicals
       -fixed                           no   -fpconstant
       -fpe3                                 -fprm nearest

Page 6           Source Listing                  ENSADD
2015-06-03 22:07                                 ENSADD.f

  no   -ftz                                  -fp_model noprecise
       -fp_model fast                        -fp_model nostrict
       -fp_model nosource                    -fp_model nodouble
       -fp_model noextended                  -fp_model novery_fast
       -fp_model noexcept                    -fp_model nono_except
       -heap_arrays 0                   no   -threadprivate_compat
       -g0                                   -iface nomixed_str_len_arg
       -iface nono_mixed_str_len_arg    no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
  no   -module                               -names lowercase
  no   -noinclude                            -O2
  no   -pad_source                           -real_size 32
  no   -recursive                            -reentrancy none
  no   -sharable_localsaves                  -vec=simd
       -show noinclude                       -show map
       -show options                    no   -syntax_only
  no   -threadcom                       no   -U
  no   -vms                                  -w noall
       -w nonone                             -w alignments
       -w noargument_checking                -w nodeclarations
       -w general                            -w noignore_bounds
       -w noignore_loc                       -w nointerfaces
       -w notruncated_source                 -w uncalled
       -w uninitialized                      -w nounused
       -w usage

       -includepath : /gpfs/gp1/usrx/local/intel/composer_xe_2011_sp1.11.339/compiler/include/,.f,./.f,/usrx/local/intel/composerxe/mkl/include/.f,
           /usrx/local/intel/composerxe/tbb/include/.f,/gpfs/gp1/usrx/local/intel/composer_xe_2011_sp1.11.339/compiler/include/intel64/.f,
           /gpfs/gp1/usrx/local/intel/composer_xe_2011_sp1.11.339/compiler/include/.f,/usr/local/include/.f,/usr/lib/gcc/x86_64-redhat-linux/4.4.7/include/.f,
           /usr/include/.f,/usr/include/.f
       -list filename : ENSADD.lst
       -o    filename : none

COMPILER: Intel(R) Fortran 12.1-2100
