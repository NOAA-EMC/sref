#!/bin/bash

#BSUB -oo _SREFDIR_/run/sref_fcst__MODEL___MEMBER_.log
#BSUB -eo _SREFDIR_/run/sref_fcst__MODEL___MEMBER_.log
#BSUB -J SREF_FCST__MODEL___MEMBER_
#BSUB -n _TASKS_
#BSUB -x
#BSUB -R span[ptile=28]
#BSUB -W 03:00
#BSUB -q "dev"
#BSUB -P SREF-T2O

set -eux

trap 'echo "SREF error _MODEL_ _MEMBER_ FCST" >> /gpfs/dell2/ptmp/$LOGNAME/tmpnwprd/jlogfile_sref' INT TERM ERR
echo "SREF started _MODEL_ _MEMBER_ FCST" >> /gpfs/dell2/ptmp/$LOGNAME/tmpnwprd/jlogfile_sref

. /usrx/local/prod/lmod/lmod/init/bash
module purge
module load lsf/10.1
module load ips/18.0.1.163
module load prod_util/1.1.0
module load grib_util/1.1.0
module load NetCDF/4.5.0

export OMP_NUM_THREADS=1

export RUN_ENVIR=para
export envir=prod
export job=$$

export CONFIG_FILE=_SREFDIR_/parm/sref_para_config_dell

export PDY=_PDY_
export cyc=_CYC_
export FLENGTH=_FLENGTH_
export INCR=_INCR_
export MODEL=_MODEL_
export MEMBER=_MEMBER_
export IOFORM=_IOFORM_
export RES=_RES_
export MACHINE=_MACHINE_
export N_TASK=$LSB_DJOB_NUMPROC

_SREFDIR_/jobs/JSREF_WRF_FCST

echo "SREF finished _MODEL_ _MEMBER_ FCST" >> /gpfs/dell2/ptmp/$LOGNAME/tmpnwprd/jlogfile_sref

bsub < _SREFDIR_/run/SREF_POST__MODEL___MEMBER_.bsub
bsub < _SREFDIR_/run/SREF_POST2__MODEL___MEMBER_.bsub
bsub < _SREFDIR_/run/SREF_POST3__MODEL___MEMBER_.bsub
bsub < _SREFDIR_/run/SREF_POST4__MODEL___MEMBER_.bsub
echo "SREF waiting _MODEL_ _MEMBER_ POST" >> /gpfs/dell2/ptmp/$LOGNAME/tmpnwprd/jlogfile_sref
echo "SREF waiting _MODEL_ _MEMBER_ POST2" >> /gpfs/dell2/ptmp/$LOGNAME/tmpnwprd/jlogfile_sref
echo "SREF waiting _MODEL_ _MEMBER_ POST3" >> /gpfs/dell2/ptmp/$LOGNAME/tmpnwprd/jlogfile_sref
echo "SREF waiting _MODEL_ _MEMBER_ POST4" >> /gpfs/dell2/ptmp/$LOGNAME/tmpnwprd/jlogfile_sref

