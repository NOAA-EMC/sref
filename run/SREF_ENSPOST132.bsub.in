#!/bin/bash

#BSUB -oo _SREFDIR_/run/sref_enspost132__ORDER_.log
#BSUB -eo _SREFDIR_/run/sref_enspost132__ORDER_.log
#BSUB -J SREF_ENSPOST
#BSUB -n 1
#BSUB -x ##not_shared
#BSUB -R span[ptile=1]
##BSUB -R span[ptile=1]
##BSUB -R "rusage[mem=27648]"
#BSUB -W 03:00
#BSUB -P SREF-T2O
#BSUB -q "devhigh"
#BSUB -a poe
##BSUB -M 110

set -aeux

trap 'echo "SREF error ENSPOST132_$ORDER" >> /ptmpp1/$LOGNAME/tmpnwprd/jlogfile_sref' INT TERM ERR
echo "SREF started ENSPOST132_$ORDER" >> /ptmpp1/$LOGNAME/tmpnwprd/jlogfile_sref

. /usrx/local/Modules/3.2.9/init/bash
module load ibmpe
module load ics

export OMP_NUM_THREADS=1
export MP_EUIDEVICE=sn_all
export MP_EUILIB=us
export MP_MPILIB=mpich2
export MP_TASK_AFFINITY=core:1

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usrx/local/NetCDF/3.6.3/lib


export RUN_ENVIR=para
export envir=prod
export job=$$

export CONFIG_FILE=_SREFDIR_/parm/sref_para_config_wcoss

export PDY=_PDY_
export cyc=_CYC_
export order=_ORDER_

_SREFDIR_/jobs/JSREF_ENSPOST132

echo "SREF finished ENSPOST132_$ORDER" >> /ptmpp1/$LOGNAME/tmpnwprd/jlogfile_sref

# Submit next job here:
#bsub < _SREFDIR_/run/SREF_POST__MODEL___MEMBER_.bsub
#echo "SREF waiting _MODEL_ _MEMBER_ POST" >> /ptmpp1/$LOGNAME/tmpnwprd/jlogfile_sref

